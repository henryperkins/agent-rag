# =============================================================================
# AGENTIC RAG - ENVIRONMENT CONFIGURATION TEMPLATE
# =============================================================================
# Copy this file to .env and fill in your actual values
# Documentation: See README.md for detailed configuration guide
# =============================================================================

# -----------------------------------------------------------------------------
# APPLICATION SETTINGS
# -----------------------------------------------------------------------------
PROJECT_NAME=agentic-azure-chat
NODE_ENV=development
PORT=8787

# -----------------------------------------------------------------------------
# AZURE AI SEARCH CONFIGURATION
# -----------------------------------------------------------------------------
# Your Azure AI Search service endpoint and credentials
# Requires: Hybrid semantic search enabled on your index
AZURE_SEARCH_ENDPOINT=https://your-search-service.search.windows.net

# Management API version (for index operations, default works for most use cases)
AZURE_SEARCH_API_VERSION=2025-08-01-preview

# Data Plane API version (for search queries)
# ‚ö†Ô∏è  IMPORTANT: Use valid stable version to avoid errors
# Valid versions: 2025-09-01 (stable, recommended), 2025-08-01-preview
# See docs/TROUBLESHOOTING.md for version validation
AZURE_SEARCH_DATA_PLANE_API_VERSION=2025-09-01

AZURE_SEARCH_INDEX_NAME=your-index-name
AZURE_SEARCH_API_KEY=your-search-api-key

# Optional: Knowledge Agent Name (if using Azure AI Search knowledge agents)
AZURE_KNOWLEDGE_AGENT_NAME=your-knowledge-agent

# -----------------------------------------------------------------------------
# AZURE OPENAI CONFIGURATION
# -----------------------------------------------------------------------------
# ‚ö†Ô∏è  IMPORTANT: Use DEPLOYMENT NAMES, not model names
# Example: If your deployment is named "gpt-5", use "gpt-5" (not "gpt-4o")
# To list deployments: az cognitiveservices account deployment list --name <resource> --resource-group <rg>

# Main GPT deployment for answer generation
AZURE_OPENAI_ENDPOINT=https://your-openai.openai.azure.com
AZURE_OPENAI_API_VERSION=v1
AZURE_OPENAI_GPT_DEPLOYMENT=gpt-4o  # Your deployment name in Azure OpenAI Studio
AZURE_OPENAI_GPT_MODEL_NAME=gpt-4o-2024-08-06  # Model name (for reference only)
AZURE_OPENAI_API_KEY=your-openai-api-key

# Embedding deployment for vector similarity
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large  # Your embedding deployment name
AZURE_OPENAI_EMBEDDING_ENDPOINT=https://your-embedding.cognitiveservices.azure.com
AZURE_OPENAI_EMBEDDING_API_KEY=your-embedding-api-key

# -----------------------------------------------------------------------------
# GOOGLE CUSTOM SEARCH (Optional - for web search)
# -----------------------------------------------------------------------------
# Leave blank to disable web search functionality
GOOGLE_SEARCH_API_KEY=your-google-api-key
GOOGLE_SEARCH_ENGINE_ID=your-search-engine-id
GOOGLE_SEARCH_ENDPOINT=https://customsearch.googleapis.com/customsearch/v1

# -----------------------------------------------------------------------------
# RETRIEVAL SETTINGS
# -----------------------------------------------------------------------------
RAG_TOP_K=5
RERANKER_THRESHOLD=2.5
RETRIEVAL_FALLBACK_RERANKER_THRESHOLD=1.5
MAX_DOCS_FOR_RERANKER=100
TARGET_INDEX_MAX_DOCUMENTS=100
RETRIEVAL_MIN_DOCS=3

# -----------------------------------------------------------------------------
# CRITIC SETTINGS (Quality Assurance)
# -----------------------------------------------------------------------------
ENABLE_CRITIC=true
CRITIC_MAX_RETRIES=1
CRITIC_THRESHOLD=0.8

# CITATION TRACKING (Learning Loop for Retrieval)
# Cost Impact: Minimal | Risk: LOW | Requires: ENABLE_SEMANTIC_MEMORY=true
ENABLE_CITATION_TRACKING=true

# WEB QUALITY FILTERING (Spam & Low-Quality Result Removal)
# Cost Impact: +$10-20/month (embedding calls) | Risk: LOW
ENABLE_WEB_QUALITY_FILTER=true
WEB_MIN_AUTHORITY=0.3
WEB_MAX_REDUNDANCY=0.9
WEB_MIN_RELEVANCE=0.3

# -----------------------------------------------------------------------------
# CONTEXT ENGINEERING
# -----------------------------------------------------------------------------
CONTEXT_HISTORY_TOKEN_CAP=1800
CONTEXT_SUMMARY_TOKEN_CAP=600
CONTEXT_SALIENCE_TOKEN_CAP=400
CONTEXT_MAX_RECENT_TURNS=12
CONTEXT_MAX_SUMMARY_ITEMS=6
CONTEXT_MAX_SALIENCE_ITEMS=6
PLANNER_CONFIDENCE_DUAL_RETRIEVAL=0.45

# -----------------------------------------------------------------------------
# WEB SEARCH SETTINGS
# -----------------------------------------------------------------------------
WEB_CONTEXT_MAX_TOKENS=8000
WEB_RESULTS_MAX=6
WEB_SEARCH_MODE=full

# -----------------------------------------------------------------------------
# SECURITY & RATE LIMITING
# -----------------------------------------------------------------------------
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=10
REQUEST_TIMEOUT_MS=30000
CORS_ORIGIN=http://localhost:5173,http://localhost:5174,http://localhost:5175
LOG_LEVEL=info

# =============================================================================
# FEATURE FLAGS - ADVANCED CAPABILITIES
# =============================================================================
# ‚ö†Ô∏è  All advanced features are DISABLED by default for safety
# üí° Enable progressively based on your needs and budget
# =============================================================================

# LAZY RETRIEVAL (Summary-First Document Loading)
# Cost Impact: -40-50% retrieval token savings | Risk: LOW
ENABLE_LAZY_RETRIEVAL=false
LAZY_SUMMARY_MAX_CHARS=300
LAZY_PREFETCH_COUNT=10
LAZY_LOAD_THRESHOLD=0.5

# SEMANTIC SUMMARY SELECTION (Embedding-Based Context)
# Cost Impact: +$20-30/month | Risk: LOW
ENABLE_SEMANTIC_SUMMARY=false

# INTENT ROUTING (Adaptive Model Selection)
# Cost Impact: -20-30% savings | Risk: LOW
ENABLE_INTENT_ROUTING=false

# ‚ö†Ô∏è  CRITICAL: INTENT_CLASSIFIER_MODEL must be a DEPLOYMENT NAME (not model name)
# Example: Use "gpt-5" if that's your deployment name, NOT "gpt-4o-mini"
# See docs/TROUBLESHOOTING.md for DeploymentNotFound errors
INTENT_CLASSIFIER_MODEL=gpt-4o-mini  # Replace with your actual deployment name

# ‚ö†Ô∏è  CRITICAL: Must be >= 16 (Azure OpenAI minimum), recommended 100+
INTENT_CLASSIFIER_MAX_TOKENS=100  # Changed from 10 (below minimum)

# Model routing (can be model names OR deployment names)
MODEL_FAQ=gpt-4o-mini
MODEL_FACTUAL=gpt-4o-mini
MODEL_RESEARCH=gpt-4o
MODEL_CONVERSATIONAL=gpt-4o-mini

# Token limits per intent
MAX_TOKENS_FAQ=500
MAX_TOKENS_FACTUAL=600
MAX_TOKENS_RESEARCH=2000
MAX_TOKENS_CONVERSATIONAL=400

# SEMANTIC MEMORY (Persistent Cross-Session Context)
# Cost Impact: +$50-100/month | Risk: LOW (requires better-sqlite3)
ENABLE_SEMANTIC_MEMORY=false
SEMANTIC_MEMORY_DB_PATH=./data/semantic-memory.db
SEMANTIC_MEMORY_RECALL_K=3
SEMANTIC_MEMORY_MIN_SIMILARITY=0.6
SEMANTIC_MEMORY_PRUNE_AGE_DAYS=90

# QUERY DECOMPOSITION (Complex Multi-Step Questions)
# Cost Impact: +2-3x tokens for complex queries | Risk: MEDIUM
ENABLE_QUERY_DECOMPOSITION=false
DECOMPOSITION_COMPLEXITY_THRESHOLD=0.6
DECOMPOSITION_MAX_SUBQUERIES=8

# WEB SEARCH RERANKING (Unified Azure + Web Results)
# Cost Impact: Minimal | Risk: LOW
ENABLE_WEB_RERANKING=false
RRF_K_CONSTANT=60
RERANKING_TOP_K=10
ENABLE_SEMANTIC_BOOST=false
SEMANTIC_BOOST_WEIGHT=0.3

# =============================================================================
# RECOMMENDED CONFIGURATIONS
# =============================================================================

# MINIMAL (Development/Budget) - Est. $200-300/month
# ENABLE_CRITIC=true
# ENABLE_INTENT_ROUTING=true
# ENABLE_LAZY_RETRIEVAL=true

# BALANCED (Production) - Est. $400-600/month
# ENABLE_CRITIC=true
# ENABLE_INTENT_ROUTING=true
# ENABLE_LAZY_RETRIEVAL=true
# ENABLE_WEB_RERANKING=true
# ENABLE_SEMANTIC_SUMMARY=true

# FULL FEATURES (Enterprise) - Est. $700-1000/month
# All flags enabled

# =============================================================================
# PROGRESSIVE ENABLEMENT (Week-by-Week)
# =============================================================================
# Week 1: Enable INTENT_ROUTING + LAZY_RETRIEVAL (cost optimization)
# Week 2: Add WEB_RERANKING + SEMANTIC_SUMMARY (quality boost)
# Week 3: Add QUERY_DECOMPOSITION + SEMANTIC_MEMORY (advanced features)
# =============================================================================
